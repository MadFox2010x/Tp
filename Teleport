-- ✅ Teleport GUI & Fly by Mad Fox
-- Работает после смерти, можно менять скорость, полноценный флай
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Проверка на PlayerGui
repeat wait() until LocalPlayer:FindFirstChild("PlayerGui")

local function createGUI()
    if LocalPlayer.PlayerGui:FindFirstChild("TeleportGUI") then
        LocalPlayer.PlayerGui.TeleportGUI:Destroy()
    end

    local gui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
    gui.Name = "TeleportGUI"
    gui.ResetOnSpawn = false

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 250, 0, 330)
    frame.Position = UDim2.new(0.3, 0, 0.3, 0)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Text = "Mad Fox Menu"
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.SourceSansBold
    title.TextSize = 16

    local input = Instance.new("TextBox", frame)
    input.Size = UDim2.new(1, -20, 0, 30)
    input.Position = UDim2.new(0, 10, 0, 40)
    input.PlaceholderText = "Имя игрока"
    input.Text = ""
    input.TextColor3 = Color3.new(1,1,1)
    input.BackgroundColor3 = Color3.fromRGB(60, 60, 60)

    local function btn(text, y)
        local b = Instance.new("TextButton", frame)
        b.Size = UDim2.new(1, -20, 0, 30)
        b.Position = UDim2.new(0, 10, 0, y)
        b.Text = text
        b.TextColor3 = Color3.new(1, 1, 1)
        b.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        return b
    end

    local toBtn = btn("Телепорт к игроку", 80)
    local bringBtn = btn("Телепорт игрока к себе", 120)
    local saveBtn = btn("Сохранить позицию", 160)
    local tpPosBtn = btn("Телепорт на позицию", 200)
    local flyBtn = btn("Флай: OFF", 240)
    local speedLabel = btn("Скорость: 5", 280)
    speedLabel.AutoButtonColor = false

    local speed = 5
    local flying = false
    local flyControl
    local savedPos = nil

    -- Управление скоростью
    local plusBtn = Instance.new("TextButton", frame)
    plusBtn.Size = UDim2.new(0, 30, 0, 30)
    plusBtn.Position = UDim2.new(1, -35, 0, 280)
    plusBtn.Text = "+"
    plusBtn.TextColor3 = Color3.new(1,1,1)
    plusBtn.BackgroundColor3 = Color3.fromRGB(90, 90, 90)

    local minusBtn = plusBtn:Clone()
    minusBtn.Parent = frame
    minusBtn.Position = UDim2.new(1, -70, 0, 280)
    minusBtn.Text = "-"

    plusBtn.MouseButton1Click:Connect(function()
        if speed < 10 then speed += 1 end
        speedLabel.Text = "Скорость: "..speed
    end)
    minusBtn.MouseButton1Click:Connect(function()
        if speed > 0 then speed -= 1 end
        speedLabel.Text = "Скорость: "..speed
    end)

    -- Телепорт к игроку
    toBtn.MouseButton1Click:Connect(function()
        local t = Players:FindFirstChild(input.Text)
        if t and t.Character and t.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character:MoveTo(t.Character.HumanoidRootPart.Position)
        end
    end)

    -- Притянуть игрока
    bringBtn.MouseButton1Click:Connect(function()
        local t = Players:FindFirstChild(input.Text)
        if t and t.Character and t.Character:FindFirstChild("HumanoidRootPart") then
            t.Character:MoveTo(LocalPlayer.Character.HumanoidRootPart.Position)
        end
    end)

    -- Сохранение позиции
    saveBtn.MouseButton1Click:Connect(function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then savedPos = hrp.Position end
    end)

    -- Телепорт на сохранённую позицию
    tpPosBtn.MouseButton1Click:Connect(function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp and savedPos then
            hrp.CFrame = CFrame.new(savedPos)
        end
    end)

    -- Флай
    flyBtn.MouseButton1Click:Connect(function()
        flying = not flying
        flyBtn.Text = flying and "Флай: ON" or "Флай: OFF"

        if flying then
            local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end
            flyControl = Instance.new("BodyVelocity", hrp)
            flyControl.MaxForce = Vector3.new(1e5, 1e5, 1e5)
            flyControl.Velocity = Vector3.zero

            RunService:BindToRenderStep("FlyControl", Enum.RenderPriority.Input.Value, function()
                if not flying or not LocalPlayer.Character then return end
                local move = Vector3.zero
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += workspace.CurrentCamera.CFrame.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= workspace.CurrentCamera.CFrame.LookVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= workspace.CurrentCamera.CFrame.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += workspace.CurrentCamera.CFrame.RightVector end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0, 1, 0) end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then move -= Vector3.new(0, 1, 0) end
                flyControl.Velocity = move.Unit * speed * 10
            end)
        else
            if flyControl then flyControl:Destroy() end
            RunService:UnbindFromRenderStep("FlyControl")
        end
    end)
end

-- Автоматическое восстановление GUI после смерти
LocalPlayer.CharacterAdded:Connect(function()
    wait(1)
    createGUI()
end)

createGUI()
